<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#BF1E2E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/images/pwa-icon-192.png">
    <link rel="manifest" href="/manifest.json">

    <!-- SEO & Meta Tags -->
    <title>Bipol Tracker - Pelacak Bus PNJ Real-Time</title>
    <meta name="description"
        content="Pantau posisi bus kampus PNJ (Bipol) secara real-time. Cek jadwal, rute pagi/sore, dan estimasi kedatangan armada. Solusi transportasi cerdas untuk mahasiswa PNJ.">
    <meta name="keywords"
        content="Bipol Tracker, Bus PNJ, Pelacak Bus, Jadwal Bus PNJ, Transportasi PNJ, Politeknik Negeri Jakarta, Real-time Bus Tracking">
    <meta name="author" content="Bipol Team">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.bipoltracker.cloud/">
    <meta property="og:title" content="Bipol Tracker - Pelacak Bus PNJ Real-Time">
    <meta property="og:description"
        content="Pantau posisi bus kampus PNJ (Bipol) secara real-time. Cek jadwal, rute pagi/sore, dan estimasi kedatangan armada.">
    <meta property="og:image" content="https://www.bipoltracker.cloud/images/header.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.bipoltracker.cloud/">
    <meta property="twitter:title" content="Bipol Tracker - Pelacak Bus PNJ Real-Time">
    <meta property="twitter:description"
        content="Pantau posisi bus kampus PNJ (Bipol) secara real-time. Cek jadwal, rute pagi/sore, dan estimasi kedatangan armada.">
    <meta property="twitter:image" content="https://www.bipoltracker.cloud/images/header.png">

    <link rel="icon" href="/images/favicon.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/src/css/style.css">
</head>

<body>
    <!-- BIPOL Mobile App Promo Popup -->
    <div id="mobileAppPopup" class="app-promo-overlay">
        <div class="app-promo-popup">
            <button class="promo-close-btn" onclick="closeAppPopup()" aria-label="Tutup">
                <i class="fa-solid fa-times"></i>
            </button>

            <div class="promo-glow"></div>

            <div class="promo-icon-container">
                <div class="phone-mockup">
                    <i class="fa-solid fa-mobile-screen-button"></i>
                </div>
                <div class="android-badge">
                    <i class="fa-brands fa-android"></i>
                </div>
            </div>

            <div class="promo-content">
                <div class="promo-badge">
                    <i class="fa-solid fa-rocket"></i> BARU
                </div>
                <h2 class="promo-title">BIPOL Mobile Tersedia!</h2>
                <p class="promo-desc">Akses pelacakan bus lebih <strong>cepat</strong> dan <strong>stabil</strong>
                    langsung dari HP Android Anda.</p>

                <a href="/assets/apk/bipol-tracker.apk" download class="promo-download-btn">
                    <i class="fa-solid fa-download"></i>
                    <span>Download App (APK)</span>
                </a>

                <div class="promo-meta">
                    <span><i class="fa-solid fa-tag"></i> Versi 1.0 (Beta)</span>
                    <span class="divider">â€¢</span>
                    <span><i class="fa-solid fa-gift"></i> Gratis</span>
                </div>
            </div>
        </div>
    </div>

    <style>
        .app-promo-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-promo-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .app-promo-popup {
            position: relative;
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 32px;
            padding: 40px 32px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: scale(0.8) translateY(40px);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }

        .app-promo-overlay.show .app-promo-popup {
            transform: scale(1) translateY(0);
        }

        .promo-glow {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(191, 30, 46, 0.3), transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(21, 155, 179, 0.3), transparent 50%);
            animation: glowRotate 10s linear infinite;
            pointer-events: none;
        }

        @keyframes glowRotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .promo-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .promo-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: rotate(90deg);
        }

        .promo-icon-container {
            position: relative;
            margin-bottom: 24px;
            display: inline-block;
        }

        .phone-mockup {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #BF1E2E 0%, #ff4757 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            box-shadow:
                0 20px 40px rgba(191, 30, 46, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
            animation: floatPhone 3s ease-in-out infinite;
            position: relative;
        }

        @keyframes floatPhone {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .android-badge {
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3DDC84, #00C853);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            box-shadow: 0 8px 20px rgba(61, 220, 132, 0.4);
            border: 3px solid #1a1a2e;
            animation: bounceIn 0.6s 0.3s backwards;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .promo-content {
            position: relative;
            z-index: 5;
        }

        .promo-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: #1a1a2e;
            font-size: 0.7rem;
            font-weight: 800;
            padding: 6px 14px;
            border-radius: 100px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4);
            }

            50% {
                box-shadow: 0 0 0 10px rgba(245, 158, 11, 0);
            }
        }

        .promo-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
            margin: 0 0 12px 0;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .promo-desc {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            line-height: 1.6;
            margin: 0 0 24px 0;
        }

        .promo-desc strong {
            color: #4ade80;
        }

        .promo-download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 18px 32px;
            background: linear-gradient(135deg, #BF1E2E 0%, #e53e3e 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 16px;
            text-decoration: none;
            box-shadow:
                0 15px 30px rgba(191, 30, 46, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .promo-download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .promo-download-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 20px 40px rgba(191, 30, 46, 0.5),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
        }

        .promo-download-btn:hover::before {
            left: 100%;
        }

        .promo-download-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .promo-download-btn i {
            font-size: 1.3rem;
        }

        .promo-meta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        .promo-meta i {
            color: rgba(255, 255, 255, 0.4);
        }

        .promo-meta .divider {
            opacity: 0.3;
        }

        @media (max-width: 480px) {
            .app-promo-popup {
                padding: 32px 24px;
                border-radius: 24px;
            }

            .promo-title {
                font-size: 1.5rem;
            }

            .phone-mockup {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }

            .android-badge {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
        }
    </style>

    <script>
        function closeAppPopup() {
            const popup = document.getElementById('mobileAppPopup');
            popup.classList.remove('show');
            localStorage.setItem('bipolAppPopupDismissed', Date.now());
        }

        function showAppPopup() {
            const popup = document.getElementById('mobileAppPopup');
            popup.classList.add('show');
        }

        // Check if popup should be shown
        document.addEventListener('DOMContentLoaded', function () {
            const dismissed = localStorage.getItem('bipolAppPopupDismissed');
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;

            // Show popup if never dismissed or dismissed more than 1 day ago
            if (!dismissed || (now - parseInt(dismissed)) > oneDay) {
                // Delay popup to let page load first
                setTimeout(showAppPopup, 2000);
            }
        });

        // Close on backdrop click
        document.getElementById('mobileAppPopup').addEventListener('click', function (e) {
            if (e.target === this) {
                closeAppPopup();
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeAppPopup();
            }
        });
    </script>

    <div id="arrival-notification-container" class="arrival-notification-container"></div>

    <a href="#bus-list" class="skip-link">Skip to content</a>

    <div class="offline-indicator" id="offline-indicator">
        <i class="fa-solid fa-wifi"></i>
        <span>Mode Offline - Menampilkan data tersimpan</span>
    </div>

    <div id="map" role="application" aria-label="Peta pelacakan bus"></div>

    <div class="floating-controls">
        <a href="/admin" class="fab-btn admin-btn" title="Admin Panel" aria-label="Admin Panel">
            <i class="fa-solid fa-user-shield"></i>
        </a>
    </div>

    <div class="bottom-sheet">
        <div class="sheet-handle-bar">
            <div class="sheet-handle"></div>
        </div>
        <div class="sheet-header">
            <div class="header-text" style="display:flex; justify-content:space-between; align-items:center;">
                <div style="flex:1;">
                    <h1 style="display:flex; align-items:center; gap:8px;">Bipol Tracker</h1>
                    <div class="dashboard-routes" style="display:flex; gap:8px; margin-top:8px; margin-bottom:8px;">
                        <button class="chip-dashboard pagi active-route" onclick="toggleRoute('rutePagi', this)">
                            <i class="fa-solid fa-sun"></i> Pagi
                        </button>
                        <button class="chip-dashboard sore active-route" onclick="toggleRoute('ruteSore', this)">
                            <i class="fa-solid fa-cloud-moon"></i> Sore
                        </button>
                    </div>
                </div>
                <div style="display:flex; gap:8px;">
                    <button id="toggleSheetBtn" class="fab-btn" title="Toggle Dashboard" aria-label="Toggle Dashboard"
                        style="width:36px; height:36px; box-shadow:none; border:1px solid rgba(0,0,0,0.1);"><i
                            class="fa-solid fa-chevron-down"></i></button>
                    <button id="recenterBtn" class="fab-btn" title="Reset Lokasi" aria-label="Reset Lokasi"
                        style="width:36px; height:36px; box-shadow:none; border:1px solid rgba(0,0,0,0.1);"><i
                            class="fa-solid fa-location-crosshairs"></i></button>
                </div>
            </div>
        </div>
        <div class="sheet-content">
            <h3>Armada Aktif</h3>
            <div id="bus-list">
                <div class="skeleton-loader hidden" id="skeleton-loader">
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                </div>
                <div class="empty-state" id="empty-state">
                    <i class="fa-solid fa-satellite-dish fa-spin"></i>
                    <p>Mencari sinyal satelit...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="info-page" class="page-view">
        <div class="page-header">
            <h2><i class="fa-solid fa-bullhorn"></i> Info & Pengumuman</h2>
        </div>
        <div class="page-content" id="dynamic-info-list">
        </div>
    </div>

    <div id="faq-page" class="page-view">
        <div class="page-header">
            <h2><i class="fa-solid fa-circle-question"></i> FAQ & Panduan</h2>
        </div>
        <div class="page-content faq-content">
            <div class="faq-intro">
                <p>Selamat datang di Bipol Tracker! Berikut penjelasan fitur-fitur yang tersedia di aplikasi ini.</p>
            </div>

            <div class="faq-section">
                <h3><i class="fa-solid fa-bus"></i> Status Armada</h3>

                <div class="faq-item">
                    <div class="faq-icon status-green"><i class="fa-solid fa-bus"></i></div>
                    <div class="faq-text">
                        <h4>Berjalan <span class="status-dot dot-green"></span></h4>
                        <p>Bus sedang bergerak dengan kecepatan lebih dari 0 km/h. Status ini menunjukkan armada aktif
                            beroperasi di jalur.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-icon status-yellow"><i class="fa-solid fa-circle-pause"></i></div>
                    <div class="faq-text">
                        <h4>Berhenti <span class="status-dot dot-yellow"></span></h4>
                        <p>Bus berhenti sementara (kecepatan 0 km/h) kurang dari 5 menit. Kemungkinan sedang
                            menurunkan/menaikkan penumpang atau berhenti di lampu merah.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-icon status-gray"><i class="fa-solid fa-square-parking"></i></div>
                    <div class="faq-text">
                        <h4>Parkir <span class="status-dot dot-gray"></span></h4>
                        <p>Bus sudah berhenti lebih dari 5 menit. Kemungkinan sedang parkir, istirahat, atau tidak
                            beroperasi.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-icon status-red"><i class="fa-solid fa-triangle-exclamation"></i></div>
                    <div class="faq-text">
                        <h4>Gas Tinggi <span class="status-dot dot-red"></span></h4>
                        <p>Sensor mendeteksi kadar gas berbahaya di dalam bus melebihi batas aman (>600). Segera periksa
                            kondisi armada!</p>
                    </div>
                </div>
            </div>

            <div class="faq-section">
                <h3><i class="fa-solid fa-clock"></i> Estimasi Waktu (ETA)</h3>
                <div class="faq-item">
                    <div class="faq-icon status-blue"><i class="fa-solid fa-location-dot"></i></div>
                    <div class="faq-text">
                        <h4>Perkiraan Tiba</h4>
                        <p>Menampilkan estimasi waktu bus tiba di halte terdekat berdasarkan jarak dan kecepatan saat
                            ini. Contoh: "5 min ke Halte PNJ".</p>
                    </div>
                </div>
            </div>

            <div class="faq-section">
                <h3><i class="fa-solid fa-route"></i> Fitur Rute</h3>
                <div class="faq-item">
                    <div class="faq-icon status-orange"><i class="fa-solid fa-sun"></i></div>
                    <div class="faq-text">
                        <h4>Rute Pagi (06:30 - 10:00)</h4>
                        <p>Jalur keberangkatan pagi dari terminal ke kampus PNJ. Aktifkan untuk melihat rute di peta.
                        </p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-icon status-purple"><i class="fa-solid fa-cloud-moon"></i></div>
                    <div class="faq-text">
                        <h4>Rute Sore (14:00 - 18:00)</h4>
                        <p>Jalur kepulangan sore dari kampus PNJ ke terminal. Aktifkan untuk melihat rute di peta.</p>
                    </div>
                </div>
            </div>

            <div class="faq-section">
                <h3><i class="fa-solid fa-gauge"></i> Informasi Sensor</h3>
                <div class="faq-item">
                    <div class="faq-icon status-blue"><i class="fa-solid fa-gauge"></i></div>
                    <div class="faq-text">
                        <h4>Kecepatan (Speed)</h4>
                        <p>Kecepatan bus dalam satuan km/jam yang diambil dari GPS tracker.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-icon status-red"><i class="fa-solid fa-fire"></i></div>
                    <div class="faq-text">
                        <h4>Level Gas</h4>
                        <p>Nilai sensor gas di dalam bus. Nilai di atas 600 dianggap berbahaya dan akan memicu
                            peringatan.</p>
                    </div>
                </div>
            </div>

            <div class="faq-section">
                <h3><i class="fa-solid fa-map"></i> Penggunaan Peta</h3>
                <div class="faq-item">
                    <div class="faq-icon status-blue"><i class="fa-solid fa-hand-pointer"></i></div>
                    <div class="faq-text">
                        <h4>Klik Bus di Daftar</h4>
                        <p>Klik item bus di daftar armada untuk fokus dan mengikuti pergerakan bus tersebut di peta.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-icon status-gray"><i class="fa-solid fa-location-crosshairs"></i></div>
                    <div class="faq-text">
                        <h4>Tombol Reset Lokasi</h4>
                        <p>Klik tombol ini untuk mengembalikan tampilan peta ke posisi default dan berhenti mengikuti
                            bus.</p>
                    </div>
                </div>
            </div>

            <div class="faq-section lost-items-section">
                <h3><i class="fa-solid fa-box-open"></i> Barang Ketinggalan</h3>
                <div class="lost-items-intro">
                    <p><i class="fa-solid fa-info-circle"></i> Kehilangan barang di bus? Isi form di bawah ini dan kami
                        akan membantu mencarikan barang Anda.</p>
                </div>
                <form id="lostItemForm" class="lost-item-form" onsubmit="submitLostItem(event)">
                    <div class="form-group">
                        <label for="busPlate"><i class="fa-solid fa-bus"></i> Nomor Plat Bus</label>
                        <select id="busPlate" name="busPlate" required
                            style="width:100%; padding:12px; border:1px solid #cbd5e1; border-radius:8px; background:#fff;">
                            <option value="">Pilih Plat Bus...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="waNumber"><i class="fa-brands fa-whatsapp"></i> Nomor WhatsApp Anda</label>
                        <input type="tel" id="waNumber" name="waNumber" placeholder="Contoh: 08123456789" required
                            pattern="[0-9]+" inputmode="numeric"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    </div>
                    <div class="form-group">
                        <label for="lostMessage"><i class="fa-solid fa-message"></i> Deskripsi Barang</label>
                        <textarea id="lostMessage" name="lostMessage" rows="4"
                            placeholder="Jelaskan barang yang hilang, ciri-ciri, dan lokasi terakhir Anda melihatnya..."
                            required></textarea>
                    </div>
                    <button type="submit" class="btn-submit-lost">
                        <i class="fa-solid fa-paper-plane"></i> Kirim Laporan
                    </button>
                </form>
            </div>

            <div class="faq-section feedback-section"
                style="margin-top: 30px; border-top: 2px dashed #e2e8f0; padding-top: 30px;">
                <h3><i class="fa-solid fa-bug"></i> Lapor Bug & Saran</h3>
                <div class="lost-items-intro" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                    <p style="color: #475569;"><i class="fa-solid fa-code" style="color:#64748b;"></i> Web ini masih
                        dalam pengembangan. Jika menemukan bug sekecil apapun atau punya saran fitur, jangan sungkan
                        lapor di sini.</p>
                </div>
                <form id="feedbackForm" class="lost-item-form" onsubmit="submitFeedback(event)">
                    <div class="form-group">
                        <label><i class="fa-regular fa-user"></i> Nama (Opsional)</label>
                        <input type="text" name="name" placeholder="Nama Anda (Boleh kosong)">
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-comment-dots"></i> Detail Masukan</label>
                        <textarea name="message" rows="4" required
                            placeholder="Ceritakan bug yang Anda temukan atau fitur yang Anda inginkan..."></textarea>
                    </div>
                    <button type="submit" class="btn-submit-lost" style="background:#475569;">
                        <i class="fa-solid fa-paper-plane"></i> Kirim Masukan
                    </button>
                </form>
            </div>

            <div class="faq-footer-cta" style="margin-top:60px; text-align:center; padding:50px 20px 80px 20px;">
                <h2
                    style="font-size:1.4rem; line-height:1.2; color:#334155; font-weight:800; letter-spacing:1px; margin-bottom:15px; text-transform:uppercase; font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
                    INGIN MENJADI BAGIAN DARI<br>
                    <span
                        style="color:#f59e0b; display:block; font-size:2.4rem; margin-top:8px; text-shadow:2px 2px 0px rgba(245, 158, 11, 0.15); letter-spacing:-1px; font-weight:900;">TEAM
                        PEJUANG BIPOL?</span>
                </h2>
                <div style="font-size:1rem; color:#64748b; margin-bottom:35px; letter-spacing:2px; font-weight:600;">
                    SILAHKAN HUBUNGI</div>

                <a href="mailto:bipoltracker.tik@gmail.com?subject=Join Team Pejuang Bipol"
                    style="text-decoration:none; display:inline-flex; align-items:center; gap:12px; background:#ea4335; color:white; padding:16px 32px; border-radius:100px; font-weight:800; font-size:1.1rem; box-shadow:0 8px 25px rgba(234, 67, 53, 0.35); transition:all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); letter-spacing:0.5px;"
                    onmouseover="this.style.transform='scale(1.05) translateY(-3px)'; this.style.boxShadow='0 15px 30px rgba(234, 67, 53, 0.45)'"
                    onmouseout="this.style.transform='scale(1) translateY(0)'; this.style.boxShadow='0 8px 25px rgba(234, 67, 53, 0.35)'">
                    <i class="fa-brands fa-google" style="font-size:1.3rem;"></i> HUBUNGI VIA GMAIL
                </a>


            </div>
        </div>
    </div>

    <div id="route-view" class="page-view">
        <div class="route-panel-overlay" onclick="if(event.target === this) switchTab('home')">
            <div class="route-master-panel">
                <div class="panel-header">
                    <div class="header-content">
                        <h2><i class="fa-solid fa-route"></i> Pilih Rute</h2>
                        <p>Aktifkan rute untuk melihat jalur di peta</p>
                    </div>
                    <button class="close-route-btn" onclick="switchTab('home')" aria-label="Tutup Panel Rute"><i
                            class="fa-solid fa-times"></i></button>
                </div>
                <div class="route-list-container">
                    <div class="route-card-item" id="card-rutePagi" onclick="toggleRouteCard('rutePagi')">
                        <div class="route-card-icon morning-theme"><i class="fa-solid fa-sun"></i></div>
                        <div class="route-card-info"><span class="route-name">Rute Pagi</span>
                            <div class="route-meta"><span><i class="fa-regular fa-clock"></i> 06:30 -
                                    10:00</span><span><i class="fa-solid fa-arrow-right"></i> Berangkat</span></div>
                        </div>
                        <div class="route-checkbox">
                            <div class="custom-toggle"></div>
                        </div>
                    </div>
                    <div class="route-card-item" id="card-ruteSore" onclick="toggleRouteCard('ruteSore')">
                        <div class="route-card-icon afternoon-theme"><i class="fa-solid fa-cloud-moon"></i></div>
                        <div class="route-card-info"><span class="route-name">Rute Sore</span>
                            <div class="route-meta"><span><i class="fa-regular fa-clock"></i> 14:00 -
                                    18:00</span><span><i class="fa-solid fa-arrow-left"></i> Pulang</span></div>
                        </div>
                        <div class="route-checkbox">
                            <div class="custom-toggle"></div>
                        </div>
                    </div>
                </div>
                <div class="panel-footer-info">
                    <div class="info-pill"><i class="fa-solid fa-calendar-check"></i><span>Senin - Jumat</span></div>
                    <div class="info-pill"><i class="fa-solid fa-ban"></i><span>Libur Nasional Off</span></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script type="module" src="/src/js/app.js"></script>

    <div id="image-modal" class="image-modal" onclick="closeImage()">
        <span class="close-modal">&times;</span><img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>

    <nav class="mobile-nav" role="navigation" aria-label="Menu utama">
        <div class="nav-item" onclick="switchTab('announcement')" role="button" tabindex="0"
            aria-label="Info dan Pengumuman">
            <i class="fa-solid fa-bullhorn" aria-hidden="true"></i><span>Info</span>
        </div>
        <div class="nav-item active" onclick="switchTab('home')" role="button" tabindex="0" aria-label="Halaman Utama"
            aria-current="page">
            <i class="fa-solid fa-house" aria-hidden="true"></i><span>Home</span>
        </div>

        <div class="nav-item" onclick="switchTab('faq')" role="button" tabindex="0" aria-label="FAQ dan Panduan">
            <i class="fa-solid fa-circle-question" aria-hidden="true"></i><span>FAQ</span>
        </div>
    </nav>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(reg => {
                reg.update();
            });
        }
    </script>
    <script>
        const RATE_LIMIT_KEY = 'lastLostItemSubmit';
        const RATE_LIMIT_MINUTES = 5;

        async function submitLostItem(event) {
            event.preventDefault();

            const lastSubmit = localStorage.getItem(RATE_LIMIT_KEY);
            const now = Date.now();

            if (lastSubmit) {
                const timePassed = (now - parseInt(lastSubmit)) / 1000 / 60;
                if (timePassed < RATE_LIMIT_MINUTES) {
                    const remaining = Math.ceil(RATE_LIMIT_MINUTES - timePassed);
                    Swal.fire({
                        icon: 'warning',
                        title: 'Mohon Tunggu',
                        html: `Anda baru saja mengirim laporan.<br>Silakan tunggu <b>${remaining} menit</b> lagi untuk mengirim laporan baru.`,
                        confirmButtonColor: '#BF1E2E'
                    });
                    return;
                }
            }

            const busPlate = document.getElementById('busPlate').value.trim();
            const waNumber = document.getElementById('waNumber').value.trim();
            const lostMessage = document.getElementById('lostMessage').value.trim();

            if (!busPlate || !waNumber || !lostMessage) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Form Belum Lengkap',
                    text: 'Mohon isi semua field yang diperlukan',
                    confirmButtonColor: '#BF1E2E'
                });
                return;
            }

            if (!/^[0-9]+$/.test(waNumber)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Nomor WhatsApp Tidak Valid',
                    text: 'Nomor WhatsApp hanya boleh berisi angka',
                    confirmButtonColor: '#BF1E2E'
                });
                return;
            }

            if (waNumber.length < 10 || waNumber.length > 15) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Nomor WhatsApp Tidak Valid',
                    text: 'Nomor WhatsApp harus 10-15 digit',
                    confirmButtonColor: '#BF1E2E'
                });
                return;
            }

            Swal.fire({
                title: 'Mengirim Laporan...',
                text: 'Mohon tunggu sebentar',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading(); }
            });

            try {
                const response = await fetch('/api/lost-items', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        bus_plate: busPlate,
                        whatsapp_number: waNumber,
                        message: lostMessage
                    })
                });

                const result = await response.json();

                if (!response.ok || !result.success) {
                    throw new Error(result.error || 'Gagal mengirim laporan');
                }

                localStorage.setItem(RATE_LIMIT_KEY, now.toString());

                Swal.fire({
                    icon: 'success',
                    title: 'Laporan Diterima',
                    text: 'Terima kasih! Laporan Anda telah kami terima dan akan segera ditindaklanjuti.',
                    confirmButtonColor: '#10b981'
                });

                document.getElementById('lostItemForm').reset();

            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal Mengirim',
                    text: error.message || 'Terjadi kesalahan, silakan coba lagi',
                    confirmButtonColor: '#BF1E2E'
                });
            }
        }

        async function submitFeedback(event) {
            event.preventDefault();
            const form = event.target;
            const btn = form.querySelector('button');
            const originalContent = btn.innerHTML;

            const name = form.name.value.trim() || 'Anonim';
            const messageRaw = form.message.value.trim();

            if (messageRaw.length < 5) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Pesan Terlalu Pendek',
                    text: 'Mohon isi detail masukan minimal 5 karakter.',
                    confirmButtonColor: '#475569'
                });
                return;
            }

            const payload = {
                name: name,
                message: messageRaw
            };

            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengirim...';
            btn.disabled = true;

            try {
                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Gagal mengirim masukan');
                }

                Swal.fire({
                    icon: 'success',
                    title: 'Masukan Terkirim!',
                    text: 'Terima kasih atas kontribusi Anda dalam pengembangan Bipol Tracker.',
                    confirmButtonColor: '#475569'
                });

                form.reset();

            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal Mengirim',
                    text: error.message || 'Terjadi kesalahan jaringan',
                    confirmButtonColor: '#BF1E2E'
                });
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }

        window.addEventListener('online', () => {
            document.getElementById('offline-indicator').classList.remove('show');
            showToast('Koneksi pulih', 'success');
        });

        window.addEventListener('offline', () => {
            document.getElementById('offline-indicator').classList.add('show');
            showToast('Mode offline aktif', 'warning');
        });

        function showToast(message, type = 'info') {
            const existing = document.querySelector('.toast-notification');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.innerHTML = `<i class="fa-solid fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            document.body.appendChild(toast);

            setTimeout(() => toast.remove(), 3000);
        }

        function triggerHaptic() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        if (!navigator.onLine) {
            document.getElementById('offline-indicator').classList.add('show');
        }
    </script>
</body>

</html>